<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Mali OpenGL ES SDK v2.4.4: Fur</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="top_banner.bmp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Mali OpenGL ES SDK v2.4.4
<span id="malidevcenter"><a href="http://malideveloper.arm.com">Mali Developer Center</a></span>
   </div>
    <a id="eula" href="http://malideveloper.arm.com/develop-for-mali/mali-opengl-es-sdk-for-linux-end-user-licence-agreement-eula/
">Use of the code snippets present within these pages are subject to these EULA terms</a>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Help&#160;and&#160;Tutorials</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fur.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Fur </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Real-time fur rendering technique using OpenGL ES 2.0.</p>
<div class="image">
<img src="FurHeader.png" alt="FurHeader.png"/>
</div>
<h1><a class="anchor" id="furIntroduction"></a>
Introduction</h1>
<p>This document describes an idea for making a fur effect in real-time. The technique does not require any advanced GPU features. The example is based on OpenGL ES 2.0 API but it can be made even with the very first version.</p>
<h1><a class="anchor" id="furConceptOfShells"></a>
Concept Of Shells</h1>
<p>The concept of making the fur is based on a semi-transparent object being rendered several times. Every time when the object is rendered, its scale is increased and alpha decreased respectively. For flat geometries, it might be more effective to change position rather than scale. But for more complex objects instead of changing scale and position normal vectors can be used to modify vertices accordingly.</p>
<h1><a class="anchor" id="furWorkflow"></a>
Workflow</h1>
<p>Needless to say, the most important part of making proper fur effect is designing a proper texture. For this example the following texture has been made:</p>
<div class="image">
<img src="FurTexture.png" alt="FurTexture.png"/>
</div>
<p>Once the texture has been designed, it is time for an implementation. One has to decide the length of the fur because it directly influences the number of geometries to be rendered to achieve the proper effect. Similarly fading out of the alpha channel should be carefully taken into account. Before the actual rendering happens the OpenGL ES states must be configured to have proper blending:</p>
<div class="fragment"><div class="line"><span class="comment">/* Blending settings. */</span></div>
<div class="line">glEnable(GL_BLEND);</div>
<div class="line">glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</div>
</div><!-- fragment --><p>Bind the fur texture:</p>
<div class="fragment"><div class="line">glActiveTexture(GL_TEXTURE0);</div>
<div class="line">glBindTexture(GL_TEXTURE_2D, theFurTexture);</div>
</div><!-- fragment --><p>Now it is time to render the fur effect. The fur rendering begins from the smallest geometry and goes to the biggest one. The only thing that makes the geometry bigger is the scale in this particular example. As the geometry becomes bigger and bigger in every iteration, the transparency is increased respectively. Below is a piece of code, which is pretty generic, for making fur of any length. But it does not mean that one does not have to tune the routine for one's own purposes.</p>
<div class="fragment"><div class="line"><span class="comment">/* Draw geometry as multiple semi-transparent shells (this will give impression of fur). */</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0; index &lt; <a class="code" href="_fur_8cpp.html#ae5f49a7a4b4e2381d74f54494df42e3e">theFurLength</a>; index++)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* In an every iteration increase the scale slightly. */</span></div>
<div class="line">    scaleObject += 0.018f;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Apply the scale in the object transformation. */</span></div>
<div class="line">    <a class="code" href="_fur_8cpp.html#ab97e5d54db4133282cd6c031ed6c6ee5">theTransformation</a>.<a class="code" href="class_m_transformation.html#a19fefb5777f099292ba643de120349d2" title="The method sets an object position for the current transformation.">setObjectPosition</a>(position);</div>
<div class="line">    <a class="code" href="_fur_8cpp.html#ab97e5d54db4133282cd6c031ed6c6ee5">theTransformation</a>.<a class="code" href="class_m_transformation.html#af875e3bd7c69f19104ebc89f55fb29bb" title="The method sets a pre multiply scale in order to do a pivot transformation.">setPreObjectScale</a>(scaleObject);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Translate transformation onto MVP matrix and pass to shader as a uniform matrix. */</span></div>
<div class="line">    <a class="code" href="_fur_8cpp.html#a80764920812bf4ed97bd93befb0ec476">theProgram</a>.<a class="code" href="class_m_renderer_program.html#ad3f30bb0d0bd98befbca2aabdbdf7a59" title="The method sets a uniform parameter as a matrix.">setUniform</a>(<a class="code" href="class_m_renderer_program.html#a26f864c710ebff4cdb6b1433acd19ceeaec65d17051f50fb41cdf16396437c3ba">MRendererProgram::U_LOC_MAT_MVP</a>,</div>
<div class="line">                          <a class="code" href="_fur_8cpp.html#ab97e5d54db4133282cd6c031ed6c6ee5">theTransformation</a>.<a class="code" href="class_m_transformation.html#ac923c62e50739c5024064a0a3813ec99" title="The method returns a specified matrix from the current transformation.">getMatrix</a>(<a class="code" href="class_m_transformation.html#a90c3626b532c7d662dca7cf2bbeb7912a71637a29064f7e388fa6686aa90b8b4b">MTransformation::TYPE_MATRIX_MVP</a>));</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Modify alpha in the way that internal shells are less transparent than external ones. */</span></div>
<div class="line">    <a class="code" href="_fur_8cpp.html#a80764920812bf4ed97bd93befb0ec476">theProgram</a>.<a class="code" href="class_m_renderer_program.html#ad3f30bb0d0bd98befbca2aabdbdf7a59" title="The method sets a uniform parameter as a matrix.">setUniform</a>(<a class="code" href="class_m_renderer_program.html#a26f864c710ebff4cdb6b1433acd19ceeae52ce167894591a58eab23f48fbc6952">MRendererProgram::U_LOC_GENERIC_1</a>,</div>
<div class="line">                          <a class="code" href="fur_2_m_vector4_8h.html#ae6ac2d033665928ebff77f9eb6bd0277">MVector4f</a>(1.0f, 1.0f, 1.0f, (theFurLength - index) * 0.01f));</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Render the shell. */</span></div>
<div class="line">    <a class="code" href="_fur_8cpp.html#a06569dd5fb50f33b8cc03b5ffc6f25bc">theGeometrySphere</a>.<a class="code" href="class_m_geometry_base.html#a16208b3dd082ce694f6d469a922e9da4" title="The method renders the primitive with a program, which is passed as a parameter.">render</a>(<a class="code" href="_fur_8cpp.html#a80764920812bf4ed97bd93befb0ec476">theProgram</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="furtherImprovements"></a>
Further Improvements</h1>
<ol type="1">
<li>With OpenGL ES 3.0 use instancing in order to issue a draw call only once</li>
<li>For semi-transparent objects remember to draw back faces first </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">
        <a class="copyright" href="http://www.arm.com/">(C) ARM Ltd. 2013</a>
    </li>
  </ul>
</div>
</body>
</html>
